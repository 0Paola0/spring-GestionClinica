<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro de Citas M√©dicas</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #f0f2f5;
            min-height: 100vh;
        }

        .encabezado-principal {
            background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
            padding: 15px 40px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .logo-titulo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-header {
           width: 50px;
            height: 50px;
            background: white;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logo-header img {
           width: 50px;
            height: 50px;
            background: white;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .encabezado-principal h1 {
            color: white;
            font-size: 28px;
            font-weight: 700;
        }

        .controles-usuario {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .icono-configuracion {
            width: 32px;
            height: 32px;
            cursor: pointer;
            fill: white;
            transition: all 0.3s;
        }

        .icono-configuracion:hover {
            transform: rotate(90deg);
        }

        .perfil-usuario {
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
        }

        .avatar-usuario {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid white;
            background: white;
            overflow: hidden;
        }

        .nombre-usuario {
            color: white;
            font-size: 16px;
            font-weight: 500;
        }

        .contenedor-principal {
            padding: 40px;
            max-width: 1000px;
            margin: 0 auto;
        }

        .tarjeta-formulario {
            background: white;
            border-radius: 12px;
            padding: 40px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            margin-bottom: 25px;
            position: relative;
        }

        .encabezado-formulario {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 30px;
        }

        .info-formulario h2 {
            font-size: 26px;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 8px;
        }

        .info-formulario p {
            color: #6b7280;
            font-size: 15px;
        }

        .boton-volver {
            background: #6b7280;
            color: white;
            border: none;
            padding: 10px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
        }

        .boton-volver:hover {
            background: #4b5563;
            transform: translateY(-2px);
        }

        .formulario-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 25px;
        }

        .campo-completo {
            grid-column: 1 / -1;
        }

        .grupo-campo {
            display: flex;
            flex-direction: column;
        }

        .grupo-campo label {
            font-size: 14px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
        }

        .campo-requerido::after {
            content: " *";
            color: #ef4444;
        }

        .grupo-campo input,
        .grupo-campo select,
        .grupo-campo textarea {
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 15px;
            font-family: inherit;
            outline: none;
            transition: all 0.3s;
            background: white;
        }

        .grupo-campo input:focus,
        .grupo-campo select:focus,
        .grupo-campo textarea:focus {
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .grupo-campo select {
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 24 24' fill='%236b7280'%3E%3Cpath d='M7 10l5 5 5-5z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            padding-right: 40px;
        }

        .grupo-campo input::placeholder,
        .grupo-campo textarea::placeholder {
            color: #9ca3af;
        }

        .grupo-campo textarea {
            resize: vertical;
            min-height: 100px;
        }

        .grupo-campo input[readonly] {
            background: #f9fafb;
            color: #6b7280;
        }

        .botones-formulario {
            display: flex;
            gap: 15px;
            justify-content: flex-start;
            margin-top: 30px;
        }

        .boton-primario {
            background: #6366f1;
            color: white;
            border: none;
            padding: 14px 32px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
            flex: 1;
        }

        .boton-primario:hover {
            background: #4f46e5;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }

        .boton-primario svg {
            width: 18px;
            height: 18px;
            fill: white;
        }

        .boton-secundario {
            background: #6b7280;
            color: white;
            border: none;
            padding: 14px 32px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .boton-secundario:hover {
            background: #4b5563;
            transform: translateY(-2px);
        }

        .tarjeta-leyenda {
            background: white;
            border-radius: 12px;
            padding: 25px 30px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .titulo-leyenda {
            font-size: 16px;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 15px;
        }

        .leyenda-items {
            display: flex;
            gap: 25px;
            flex-wrap: wrap;
        }

        .leyenda-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .color-muestra {
            width: 18px;
            height: 18px;
            border-radius: 4px;
        }

        .color-consulta {
            background: #6366f1;
        }

        .color-control {
            background: #10b981;
        }

        .color-procedimiento {
            background: #f59e0b;
        }

        .color-cirugia {
            background: #3b82f6;
        }

        .color-emergencia {
            background: #ef4444;
        }

        .leyenda-texto {
            font-size: 14px;
            color: #4b5563;
        }
    </style>
</head>
<body>
<header class="encabezado-principal">
    <div class="logo-titulo">
        <div class="logo-header">
            <img src="/img/logo.png" alt="Logo">
        </div>
        <h1>Gesti√≥n Cl√≠nica</h1>
    </div>
    <div class="controles-usuario">
        <svg class="icono-configuracion" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/>
        </svg>
        <div class="perfil-usuario">
            <div class="avatar-usuario">
                <img th:if="${fotoBase64 != null}"
                     th:src="'data:image/jpeg;base64,' + ${fotoBase64}"
                     alt="Foto de perfil"
                     style="width: 100%; height: 100%; object-fit: cover;" />
                <div th:unless="${fotoBase64 != null}"
                     style="width: 100%; height: 100%; background: rgba(255,255,255,0.2); display: flex; align-items: center; justify-content: center; font-size: 16px;">
                    <span>üë§</span>
                </div>
            </div>
            <span class="nombre-usuario" th:text="${nombreUsuario}">Dr. Mart√≠nez</span>
        </div>
    </div>
</header>

<main class="contenedor-principal">
    <div class="tarjeta-formulario">
        <div class="encabezado-formulario">
            <div class="info-formulario">
                <h2 th:if="${cita == null}">Registrar Nueva Cita</h2>
                <h2 th:if="${cita != null && modoEdicion}">Editar Cita M√©dica</h2>
                <h2 th:if="${cita != null && !modoEdicion}">Ver Cita M√©dica</h2>
                <p th:if="${cita == null}">Complete la informaci√≥n para agendar una nueva cita m√©dica</p>
                <p th:if="${cita != null && modoEdicion}">Modifique la informaci√≥n de la cita m√©dica</p>
                <p th:if="${cita != null && !modoEdicion}">Informaci√≥n detallada de la cita m√©dica</p>
            </div>
            <a href="/listaCitas" class="boton-volver">Volver</a>
        </div>

        <!-- Formulario para nueva cita -->
        <form th:if="${cita == null}" action="/guardarCita" method="post">
            <div class="formulario-grid">
                <div class="grupo-campo">
                    <label class="campo-requerido">Paciente</label>
                    <select name="paciente" required>
                        <option value="">Seleccionar paciente...</option>
                        <option th:each="paciente : ${pacientes}" 
                                th:value="${paciente.nombres + ' ' + paciente.apellidos}"
                                th:text="${paciente.nombres + ' ' + paciente.apellidos}">
                        </option>
                    </select>
                </div>

                <div class="grupo-campo">
                    <label class="campo-requerido">Doctor Encargado</label>
                    <select name="doctor" required>
                        <option value="">Seleccionar doctor...</option>
                        <option th:each="doctor : ${doctores}" 
                                th:value="${doctor.nombres + ' ' + doctor.apellidos}"
                                th:text="${doctor.nombres + ' ' + doctor.apellidos}">
                        </option>
                    </select>
                </div>

                <div class="grupo-campo">
                    <label class="campo-requerido">Fecha de la Cita</label>
                    <input type="date" name="fecha" required>
                </div>

                <div class="grupo-campo">
                    <label class="campo-requerido">Hora de la Cita</label>
                    <input type="time" name="hora" required>
                </div>

                <div class="grupo-campo">
                    <label class="campo-requerido">Tipo de Cita</label>
                    <select name="tipo" required>
                        <option value="">Seleccionar tipo...</option>
                        <option value="Consulta general">Consulta general</option>
                        <option value="Laboratorio cl√≠nico">Laboratorio cl√≠nico</option>
                        <option value="Farmacia">Farmacia</option>
                        <option value="Especialidad m√©dica">Especialidad m√©dica</option>
                    </select>
                </div>

                <div class="grupo-campo">
                    <label class="campo-requerido">Estado</label>
                    <select name="estado" required>
                        <option value="Programada">Programada</option>
                        <option value="Pendiente">Pendiente</option>
                        <option value="Retrasada">Retrasada</option>
                        <option value="Cancelada">Cancelada</option>
                    </select>
                </div>

                <div class="grupo-campo">
                    <label>Tel√©fono de Contacto</label>
                    <input type="tel" name="telefono" placeholder="5690-0000">
                </div>

                <div class="grupo-campo">
                    <label class="campo-requerido">Duraci√≥n</label>
                    <select name="duracion" required>
                        <option value="">Seleccionar duraci√≥n...</option>
                        <option value="30 minutos">30 minutos</option>
                        <option value="1 hora">1 hora</option>
                        <option value="1:30 minutos">1:30 minutos</option>
                        <option value="2 horas">2 horas</option>
                    </select>
                </div>

                <div class="grupo-campo campo-completo">
                    <label>Motivo de la Consulta</label>
                    <input type="text" name="motivo" placeholder="Ej: Control rutinario, dolor abdominal...">
                </div>

                <div class="grupo-campo campo-completo">
                    <label>Observaciones</label>
                    <textarea name="observaciones" rows="4"></textarea>
                </div>
            </div>

            <div class="botones-formulario">
                <button type="submit" class="boton-primario">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                    </svg>
                    Registrar Cita
                </button>
                <button type="button" class="boton-secundario" onclick="this.form.reset()">Limpiar</button>
            </div>
        </form>

        <!-- Formulario para ver/editar cita existente -->
        <form th:if="${cita != null}" th:action="${modoEdicion ? '/citas/actualizar' : '#'}" method="post">
            <input type="hidden" name="id" th:value="${cita.id}">
            
            <div class="formulario-grid">
                <div class="grupo-campo">
                    <label class="campo-requerido">Paciente</label>
                    <select name="paciente" th:disabled="${!modoEdicion}" required>
                        <option value="">Seleccionar paciente...</option>
                        <option th:each="paciente : ${pacientes}" 
                                th:value="${paciente.nombres + ' ' + paciente.apellidos}"
                                th:text="${paciente.nombres + ' ' + paciente.apellidos}"
                                th:selected="${paciente.nombres + ' ' + paciente.apellidos == cita.nombrePaciente}">
                        </option>
                    </select>
                </div>

                <div class="grupo-campo">
                    <label class="campo-requerido">Doctor Encargado</label>
                    <select name="doctor" th:disabled="${!modoEdicion}" required>
                        <option value="">Seleccionar doctor...</option>
                        <option th:each="doctor : ${doctores}" 
                                th:value="${doctor.nombres + ' ' + doctor.apellidos}"
                                th:text="${doctor.nombres + ' ' + doctor.apellidos}"
                                th:selected="${doctor.nombres + ' ' + doctor.apellidos == cita.nombreDoctor}">
                        </option>
                    </select>
                </div>

                <div class="grupo-campo">
                    <label class="campo-requerido">Fecha de la Cita</label>
                    <input type="date" name="fecha" th:value="${cita.fecha}" th:disabled="${!modoEdicion}" required>
                </div>

                <div class="grupo-campo">
                    <label class="campo-requerido">Hora de la Cita</label>
                    <input type="time" name="hora" th:value="${cita.hora}" th:disabled="${!modoEdicion}" required>
                </div>

                <div class="grupo-campo">
                    <label class="campo-requerido">Tipo de Cita</label>
                    <select name="tipo" th:disabled="${!modoEdicion}" required>
                        <option value="">Seleccionar tipo...</option>
                        <option value="Consulta general" th:selected="${cita.tipoCita == 'Consulta general'}">Consulta general</option>
                        <option value="Laboratorio cl√≠nico" th:selected="${cita.tipoCita == 'Laboratorio cl√≠nico'}">Laboratorio cl√≠nico</option>
                        <option value="Farmacia" th:selected="${cita.tipoCita == 'Farmacia'}">Farmacia</option>
                        <option value="Especialidad m√©dica" th:selected="${cita.tipoCita == 'Especialidad m√©dica'}">Especialidad m√©dica</option>
                    </select>
                </div>

                <div class="grupo-campo">
                    <label class="campo-requerido">Estado</label>
                    <select name="estado" th:disabled="${!modoEdicion}" required>
                        <option value="Programada" th:selected="${cita.estado == 'Programada'}">Programada</option>
                        <option value="Pendiente" th:selected="${cita.estado == 'Pendiente'}">Pendiente</option>
                        <option value="Retrasada" th:selected="${cita.estado == 'Retrasada'}">Retrasada</option>
                        <option value="Cancelada" th:selected="${cita.estado == 'Cancelada'}">Cancelada</option>
                    </select>
                </div>

                <div class="grupo-campo">
                    <label>Tel√©fono de Contacto</label>
                    <input type="tel" name="telefono" th:value="${cita.telefonoContacto}" th:disabled="${!modoEdicion}" placeholder="5690-0000">
                </div>

                <div class="grupo-campo">
                    <label class="campo-requerido">Duraci√≥n</label>
                    <select name="duracion" th:disabled="${!modoEdicion}" required>
                        <option value="">Seleccionar duraci√≥n...</option>
                        <option value="30 minutos" th:selected="${cita.duracion == '30 minutos'}">30 minutos</option>
                        <option value="1 hora" th:selected="${cita.duracion == '1 hora'}">1 hora</option>
                        <option value="1:30 minutos" th:selected="${cita.duracion == '1:30 minutos'}">1:30 minutos</option>
                        <option value="2 horas" th:selected="${cita.duracion == '2 horas'}">2 horas</option>
                    </select>
                </div>

                <div class="grupo-campo campo-completo">
                    <label>Motivo de la Consulta</label>
                    <input type="text" name="motivo" th:value="${cita.motivoConsulta}" th:disabled="${!modoEdicion}" placeholder="Ej: Control rutinario, dolor abdominal...">
                </div>

                <div class="grupo-campo campo-completo">
                    <label>Observaciones</label>
                    <textarea name="observaciones" th:disabled="${!modoEdicion}" rows="4" th:text="${cita.observaciones}"></textarea>
                </div>
            </div>

            <div class="botones-formulario">
                <button th:if="${modoEdicion}" type="submit" class="boton-primario">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                    </svg>
                    Registrar Cita
                </button>
                <a href="/listaCitas" class="boton-secundario">Volver a Lista</a>
            </div>
        </form>
    </div>
</main>
</body>
</html>